//////////////////////////////////////////////////////////////////////////////////
// Cloud Zoom V1.0.0
// (c) 2010 by R Cecco. <http://www.professorcloud.com>
// MIT License
//
// Please retain this copyright header in all versions of the software
//////////////////////////////////////////////////////////////////////////////////
(function($){$(document).ready(function(){$('.cloud-zoom, .cloud-zoom-gallery').CloudZoom()});function format(a){for(var i=1;i<arguments.length;i++){a=a.replace('%'+(i-1),arguments[i])}return a}function CloudZoom(g,i){var j=$('img',g),img1,img2;var k=null;var l=null;var m=null;var n=0;var o;var p,ch;var q=0,destV=0,currV=0,currU=0;var r=null;var s=null;var t=null;var u=0;var v=-1,my;var z=this;var A;setTimeout(function(){if(l===null){var w=g.width();g.append(format('<div style="width:%0px;position:absolute;top:75%;left:%1px;text-align:center" class="cloud-zoom-loading" >Loading...</div>',w/3,(w/2)-(w/6))).find(':last').css('opacity',0.5)}},200);var B=function(){if(t!==null){t.remove();t=null}};this.removeBits=function(){if(m){m.remove();m=null;v=-1}if(r){r.remove();r=null}if(s){s.remove();s=null}B();$('.cloud-zoom-loading',g).remove()};this.destroy=function(){g.data('zoom',null);if(l){l.unbind();l.remove();l=null}if(k){k.remove();k=null}this.removeBits()};this.fadedOut=function(){if(k){k.remove();k=null}B()};this.controlLoop=function(){if(m){var x=(v-j.offset().left-(p*0.5))>>0;var y=(my-j.offset().top-(ch*0.5))>>0;if(x<0){x=0}else if(x>(j.outerWidth()-p)){x=(j.outerWidth()-p)}if(y<0){y=0}else if(y>(j.outerHeight()-ch)){y=(j.outerHeight()-ch)}m.css({left:x,top:y});m.css('background-position',(-x)+'px '+(-y)+'px');q=(((x)/j.outerWidth())*o.width)>>0;destV=(((y)/j.outerHeight())*o.height)>>0;currU+=(q-currU)/i.smoothMove;currV+=(destV-currV)/i.smoothMove;k.css('background-position',(-(currU>>0)+'px ')+(-(currV>>0)+'px'));if(v!=-1&&i.position!=='inside'){m.css({display:'block'})}}n=setTimeout(function(){z.controlLoop()},30)};this.init2=function(a,b){u++;if(b===1){o=a}if(u===2){this.init()}};this.init=function(){$('.cloud-zoom-loading',g).remove();l=g.parent().append(format("<div class='mousetrap' style='background-image:url(\".\");z-index:999;position:absolute;width:%0px;height:%1px;left:%2px;top:%3px;\'></div>",j.outerWidth(),j.outerHeight(),0,0)).find(':last');l.bind('mousemove',this,function(a){v=a.pageX;my=a.pageY});l.bind('mouseleave',this,function(a){clearTimeout(n);a.data.removeBits();k.fadeOut(300,function(){z.fadedOut()});return false});l.bind('mouseenter',this,function(a){A=a.data;if(k){k.stop(true,false);k.remove()}var b=0,yPos=0;b+=i.adjustX;yPos+=i.adjustY;var c=j.outerWidth();var d=j.outerHeight();var w=i.zoomWidth;var h=i.zoomHeight;if(i.zoomWidth=='auto'){w=c}if(i.zoomHeight=='auto'){h=d}var e=g.parent();switch(i.position){case'top':yPos-=h;break;case'right':b+=c;break;case'bottom':yPos+=d;break;case'left':b-=w;break;case'inside':w=c;h=d;break;default:e=$('#'+i.position);if(!e.length){e=g;b+=c;yPos+=d}else{w=e.innerWidth();h=e.innerHeight()}}k=e.append(format('<div id="cloud-zoom-big" class="cloud-zoom-big" style="display:none;position:absolute;left:%0px;top:%1px;width:%2px;height:%3px;background-image:url(\'%4\');z-index:99;"></div>',b,yPos,w,h,o.src)).find(':last');if(j.attr('title')&&i.showTitle){k.append(format('<div class="cloud-zoom-title">%0</div>',j.attr('title'))).find(':last').css('opacity',i.titleOpacity)}if($.browser.msie&&$.browser.version<7){t=$('<iframe frameborder="0" src="#"></iframe>').css({position:"absolute",left:b,top:yPos,zIndex:99,width:w,height:h}).insertBefore(k)}k.fadeIn(500);if(m){m.remove();m=null}p=(j.outerWidth()/o.width)*k.width();ch=(j.outerHeight()/o.height)*k.height();m=g.append(format("<div class = 'cloud-zoom-lens' style='display:none;z-index:98;position:absolute;width:%0px;height:%1px;'></div>",p,ch)).find(':last');l.css('cursor',m.css('cursor'));var f=false;if(i.tint){m.css('background','url("'+j.attr('src')+'")');r=g.append(format('<div style="position:absolute; left:0px; top:0px; width:%0px; height:%1px; background-color:%2;" />',j.outerWidth(),j.outerHeight(),i.tint)).find(':last');r.css('opacity',i.tintOpacity);f=true}if(i.softFocus){m.css('background','url("'+j.attr('src')+'")');s=g.append(format('<div style="position:absolute; display:none;top:2px; left:2px; width:%0px; height:%1px;" />',j.outerWidth()-2,j.outerHeight()-2,i.tint)).find(':last');s.css('background','url("'+j.attr('src')+'")');s.css('opacity',0.5);f=true;s.fadeIn(500)}if(!f){m.css('opacity',i.lensOpacity)}A.controlLoop();return})};img1=new Image();$(img1).load(function(){z.init2(this,0)});img1.src=j.attr('src');img2=new Image();$(img2).load(function(){z.init2(this,1)});img2.src=g.attr('href')}$.fn.CloudZoom=function(f){try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}this.each(function(){var c=$(this).attr('rel').replace(/\s+/g,''),opts;var d=c.split(','),relOpts={},splitOpt;for(var i=0;i<d.length;i++){splitOpt=d[i].split(':');if(splitOpt[1]==='true'){splitOpt[1]=true}else if(splitOpt[1]==='false'){splitOpt[1]=false}else if(isNaN(splitOpt[1])){splitOpt[1]=splitOpt[1].replace(/['"]/g,'')}else{splitOpt[1]=1*splitOpt[1]}relOpts[splitOpt[0]]=splitOpt[1]}if($(this).is('.cloud-zoom')){$(this).css({'position':'relative','display':'block'});$('img',$(this)).css({'display':'block'});if($(this).parent().attr('id')!='wrap'){$(this).wrap('<div id="wrap" style="top:0px;z-index:9999;position:relative;"></div>')}opts=$.extend({},$.fn.CloudZoom.defaults,f);opts=$.extend({},opts,relOpts);$(this).data('zoom',new CloudZoom($(this),opts))}else if($(this).is('.cloud-zoom-gallery')){opts=$.extend({},relOpts,f);$(this).data('relOpts',opts);$(this).bind('click',$(this),function(a){var b=a.data.data('relOpts');$('#'+b.useZoom).data('zoom').destroy();$('#'+b.useZoom).attr('href',a.data.attr('href'));$('#'+b.useZoom+' img').attr('src',a.data.data('relOpts').smallImage);$('#'+a.data.data('relOpts').useZoom).CloudZoom();return false})}});return this};$.fn.CloudZoom.defaults={zoomWidth:'auto',zoomHeight:'auto',position:'right',tint:false,tintOpacity:0.5,lensOpacity:0.5,softFocus:false,smoothMove:3,showTitle:true,titleOpacity:0.5,adjustX:0,adjustY:0}})(jQuery);